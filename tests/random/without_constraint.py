import numpy
import scipy.interpolate

from dinv.helper import TestRun

numpy.random.seed(1)
numpy.set_printoptions(precision=2, linewidth=210)


def constrain(potential, x_space):
    data = potential(x_space)

    data[(x_space >= 400)] = 0e-6

    interpolation = scipy.interpolate.interp1d(x_space, data, fill_value=(0, 0), bounds_error=False)
    return interpolation


test = TestRun("simulation-1-profile.dat")

test.cutoff = 0.010
test.noise = 0
test.iterations = 10000
test.tolerance = 1e-8
test.offset = 20
test.thickness = 350
test.precision = 1
test.pot_cutoff = 2
test.use_only_real_part = False
test.q_max = 0.5
test.plot_every_nth = 100
test.store_path = 'data/'

test.start = 0
    #[(-1-0j), (-0.9870764279417966-0.15869648368744507j), (-0.9484884923534075-0.31361267969528417j), (-0.8847941973988954-0.4609441970658608j), (-0.7969569164869086-0.596839877611179j), (-0.686399553122693-0.7173830940524499j), (-0.5550887241617909-0.8185820532707146j), (-0.4056573387541053-0.8963788723912914j), (-0.24157536816721992-0.9466953865275873j), (-0.06737689067932218-0.9655470108427561j), (0.11105820215869137-0.9492760577379918j), (0.28619655900266905-0.8949818663752651j), (0.44860637023424604-0.801247862634821j), (0.5869735841042747-0.6692559253275899j), (0.6887358412821486-0.5042706056922598j), (0.7418176180246038-0.3171708592074138j), (0.7378079608544916-0.1251623498070547j), (0.6761454977228591+0.049715015644600596j), (0.5674255083230224+0.18535069274284682j), (0.4329280400755808+0.2666875051565992j), (0.2988642355026726+0.2915493218956353j), (0.18771451057324942+0.2711192817124097j), (0.11168650409748579+0.22458061624450376j), (0.07152078445627605+0.1716040276793969j), (0.05974593183684675+0.12687551704068536j), (0.06533194275351058+0.09820096171437975j), (0.07741047404944794+0.08727517937183309j), (0.08735629924437241+0.0915543614185561j), (0.08953196794934291+0.10616237645841657j)]

test.plot_potential = True
test.plot_phase = False
test.plot_reflectivity = False

test.run(constrain)
